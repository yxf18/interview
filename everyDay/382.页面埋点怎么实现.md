# Problem: 页面埋点怎么实现?

*[interview]: start
## 1.为什么使用前端埋点？
主要是为了收集产品数据，它的目的是上报相关行为数据，相关人员以数据为依据来分析产品在用户端的使用情况，根据分析出来的结果辅助产品优化、迭代、以及新需求的开发。
其实就是用于流量分析
而流量的意思，包含了很多：页面浏览数(PV)、独立访问者数量(UV)、IP、页面停留时间、页面操作时间、页面访问次数、按钮点击次数、文件下载次数等。
## 2.目前项目埋点方面存在的痛点？
1. 逻辑复用问题：特别是曝光相关的点需要在业务代码里面做额外的处理，所以逻辑复用很困难，对现有代码的侵入也很严重；
2. 埋点在多个项目中分散存在，维护会比较麻烦。

## 3.前端埋点方案
目前主要有 3 种方案：
1. 手动代码埋点：用户触发某个动作后手动上报数据
优点：是最准确的，可以满足很多定制化的需求。
缺点：埋点逻辑与业务代码耦合到一起，不利于代码维护和复用。

2. 可视化埋点：通过可视化工具配置采集节点，指定自己想要监测的元素和属性。核心是查找 dom 然后绑定事件，业界比较有名的是 Mixpanel、GrowingIO、神策
优点：可以做到按需配置，又不会像全埋点那样产生大量的无用数据。
缺点：比较难加载一些运行时参数；页面结构发生变化的时候，可能就需要进行部分重新配置。

3. 无埋点(无痕埋点)：也叫“全埋点”，前端自动采集全部事件并上报埋点数据，在后端数据计算时过滤出有用数据
优点：收集用户的所有端上行为，很全面。
缺点：无效的数据很多、上报数据量大。

## 4.埋点方式
按照获取数据的方式一般分为三类：
- 页面埋点：统计用户进入或离开页面的各种维度信息，如页面浏览次数（PV）、浏览页面人数（UV）、页面停留时间、浏览器信息等。
- 点击埋点：统计用户在应用内的每一次点击事件，如报价列表的浏览次数、再次询价的次数等。
- 曝光埋点：统计具体区域是否被用户浏览到，如活动的引流入口的显示、投放广告的显示等

## 5.埋点方案
目前我们项目中埋点需求主要有，点击埋点（dom点击）、页面埋点（主要是pv）。再根据我们目前选用的vue技术栈，所以考虑了以下两种实现方式：组件方式或者指令方式
点击埋点开始的是想提供一个组件，包裹需要进行点击埋点的 dom 元素，也有可能是组件，然后给子元素绑定点击事件，当用户触发事件时进行埋点相关处理。
但是这样就必须绑定点击事件到 dom 上，但是又不想在文档结构中引入额外的 dom 元素，因为这会增加 dom 结构层级，层级会变得更复杂。
所以最终采用了**自定义指令**的方式。

>需要注意的是，在进行页面埋点时，需要遵守相关的隐私政策和法律法规，确保用户隐私的保护和合规性。同时，合理设计和选择埋点事件，避免过度收集不必要的数据，以免给用户体验带来负面影响。

## 关键词：手动代码埋点、可视化埋点、无埋点
*[interview]: end
