# Problem: WebSocket 是如何进行握手的?

*[interview]: start
WebSocket 协议在建立连接时通过一种称为“握手（handshake）”的过程来确立通信的起始点。WebSocket 握手的过程如下：

1. **客户端发起连接请求：** 客户端通过发送一个 HTTP 请求来发起 WebSocket 连接。这个请求通常由浏览器或客户端程序发起。

2. **服务端响应握手请求：** 当服务端收到客户端的握手请求后，会进行相应的处理并验证。如果服务端支持 WebSocket 协议并且接受了客户端的握手请求，它会以一个 HTTP 响应作为回应。

3. **服务端和客户端协商协议版本和握手参数：** 在 HTTP 请求和响应的过程中，客户端和服务端会协商 WebSocket 的协议版本以及其他相关参数，如请求的路径、协议升级等。

4. **服务端接受连接并返回响应：** 如果服务端接受了客户端的握手请求，它会以一个 HTTP **101** 切换协议的响应状态码来响应客户端，表示协议切换成功，连接已建立。

5. **双方开始进行 WebSocket 通信：** 一旦握手成功，客户端和服务端之间的双向通信通道就建立起来了。它们可以通过发送和接收消息来进行实时的数据交换。

在握手过程中，客户端和服务端会通过 HTTP 头部字段进行**协议的升级**和参数的传递。其中，客户端通常会在请求头部中包含一个特殊的字段 `Upgrade: websocket`，而服务端在响应头部中会包含 `Upgrade: websocket` 和 `Connection: Upgrade` 来表示协议切换。一旦握手成功，客户端和服务端就可以开始进行实时的 WebSocket 数据交换了。

## 关键词: WebSocket, 握手, 协议升级, HTTP, 101 切换协议， Upgrade, Connection
*[interview]: end
